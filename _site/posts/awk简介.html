

<!DOCTYPE html  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
  <head>
    <meta charset="utf-8">
    <title>awk简介</title>
    
    <meta name="author" content="Yaccai">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- <link href="/css/blog.css" rel="stylesheet" type="text/css" media="all"> -->
    <link href="/css/syntax.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/bootstrap.2.2.2.min.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/font-awesome.min.css" rel="stylesheet" type="text/css" media="all">
    
  <script type="text/javascript" src="/js/jquery.min.js"></script>
  <script type="text/javascript" src="/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/js/jquery.tocLight.js"></script>

    <!-- atom & rss feed -->
    <link href="" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">yaccai</a>
          <ul class="nav">
            <li><a href="/explore.html">Explore / 浏览</a></li>
            <li><a href="/archive.html">Archive / 存档</a></li>
            <li><a href="/about.html">About / 关于</a></li>

<!--             <li><a href="https://github.com/yaccai">Github</a></li> -->
          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        

<div class="page-header">
  <h11>awk简介 </h11>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span> </span>
    </div>
    <div class="content">
      <div id="toc-container">
  <table class="toc" id="toc">
    <tbody>
      <tr>
        <td>
          <div id="toctitle">
            <h2>Contents</h2>
          </div>
          <ul>
            <li class="toc_level-1 toc_section-1">
              <a href="#tocAnchor-1-1"><span class="tocnumber">1</span> <span class="toctext">语法</span></a>
              <ul>
                <li class="toc_level-2 toc_section-2">
                  <a href="#tocAnchor-1-1-1"><span class="tocnumber">1.1</span> <span class="toctext">简单的</span></a>
                </li>
                <li class="toc_level-2 toc_section-3">
                  <a href="#tocAnchor-1-1-2"><span class="tocnumber">1.2</span> <span class="toctext">复杂的</span></a>
                </li>
                <li class="toc_level-2 toc_section-4">
                  <a href="#tocAnchor-1-1-3"><span class="tocnumber">1.3</span> <span class="toctext">其他</span></a>
                </li>
              </ul>
            </li>
            <li class="toc_level-1 toc_section-5">
              <a href="#tocAnchor-1-5"><span class="tocnumber">2</span> <span class="toctext">内建变量</span></a>
            </li>
            <li class="toc_level-1 toc_section-6">
              <a href="#tocAnchor-1-6"><span class="tocnumber">3</span> <span class="toctext">匹配</span></a>
            </li>
            <li class="toc_level-1 toc_section-7">
              <a href="#tocAnchor-1-7"><span class="tocnumber">4</span> <span class="toctext">举例</span></a>
              <ul>
                <li class="toc_level-2 toc_section-8">
                  <a href="#tocAnchor-1-7-1"><span class="tocnumber">4.1</span> <span class="toctext">输出文件第十行</span></a>
                </li>
                <li class="toc_level-2 toc_section-9">
                  <a href="#tocAnchor-1-7-2"><span class="tocnumber">4.2</span> <span class="toctext">文件转置</span></a>
                </li>
                <li class="toc_level-2 toc_section-10">
                  <a href="#tocAnchor-1-7-3"><span class="tocnumber">4.3</span> <span class="toctext">有效电话号码</span></a>
                </li>
                <li class="toc_level-2 toc_section-11">
                  <a href="#tocAnchor-1-7-4"><span class="tocnumber">4.4</span> <span class="toctext">单词频率统计</span></a>
                </li>
              </ul>
            </li>
          </ul>
        </td>
      </tr>
    </tbody>
  </table>
</div><p>about AWK</p>

<!-- more -->

<h1 id="tocAnchor-1-1">语法</h1>

<p>
  <a href="http://www.gnu.org/software/gawk/manual/gawk.html">gawk</a>
</p>

<p>awk 是对输入进行逐行分析的，模式一旦匹配成功，就执行后面相应的action.</p>

<p>awk 是文本分析程序，虽然也有技巧可以使它做各种黑活，但是太tricky了，还不如来个python明白。</p>

<h2 id="tocAnchor-1-1-1">简单的</h2>

<p>awk [-F] ‘pattern {action}’ file</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>awk <span class="s1">'$3 &gt;0 { print $1, $2 * $3 }'</span> emp.data
cat /etc/passwd <span class="se">\|</span> awk  -F <span class="s1">':'</span>  <span class="s1">'{print $1"\t"$7}'</span>
awk <span class="s1">'$3==0 &amp;&amp; $6=="ESTABLE" \|\| NR==1 {printf "%02s %-20s %-20s\n",NR, $4,$5}'</span> n.txt
awk <span class="s1">'$3==0 &amp;&amp; $6=="LISTEN" || NR==1 '</span> netstat.txt <span class="c"># 这个相当于过滤一条条记录</span>
</code></pre>
</div>

<ul>
  <li>-F 指定分割符，默认是空格，还可以指明多个比如 -F ‘[;:]’’</li>
  <li>print 也可以改成完全C风格的printf</li>
  <li>其中的“==”为比较运算符。其他比较运算符：!=, &gt;, &lt;, &gt;=, &lt;=</li>
</ul>

<h2 id="tocAnchor-1-1-2">复杂的</h2>

<p>awk ‘ BEGIN {…} {…}; END{…} ‘</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>awk -F <span class="s1">':'</span> <span class="s1">'BEGIN {count=0;} {name[count] = $1;count++;}; END{for (i = 0; i &lt; NR; i++) print i, name[i]}'</span> /etc/passwd
awk  <span class="s1">'BEGIN{FS=":"} {print $1,$3,$6}'</span> /etc/passwd
</code></pre>
</div>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/awk -f</span>
<span class="c">#运行前</span>
BEGIN <span class="o">{</span>
    math <span class="o">=</span> 0
    english <span class="o">=</span> 0
    computer <span class="o">=</span> 0
 
    <span class="nb">printf</span> <span class="s2">"NAME    NO.   MATH  ENGLISH  COMPUTER   TOTAL</span><span class="se">\n</span><span class="s2">"</span>
    <span class="nb">printf</span> <span class="s2">"---------------------------------------------</span><span class="se">\n</span><span class="s2">"</span>
<span class="o">}</span>
<span class="c">#运行中</span>
<span class="o">{</span>
    math+<span class="o">=</span><span class="nv">$3</span>
    english+<span class="o">=</span><span class="nv">$4</span>
    computer+<span class="o">=</span><span class="nv">$5</span>
    <span class="nb">printf</span> <span class="s2">"%-6s %-6s %4d %8d %8d %8d</span><span class="se">\n</span><span class="s2">"</span>, <span class="nv">$1</span>, <span class="nv">$2</span>, <span class="nv">$3</span>,<span class="nv">$4</span>,<span class="nv">$5</span>, <span class="nv">$3</span>+<span class="nv">$4</span>+<span class="nv">$5</span>
<span class="o">}</span>
<span class="c">#运行后</span>
END <span class="o">{</span>
    <span class="nb">printf</span> <span class="s2">"---------------------------------------------</span><span class="se">\n</span><span class="s2">"</span>
    <span class="nb">printf</span> <span class="s2">"  TOTAL:%10d %8d %8d </span><span class="se">\n</span><span class="s2">"</span>, math, english, computer
    <span class="nb">printf</span> <span class="s2">"AVERAGE:%10.2f %8.2f %8.2f</span><span class="se">\n</span><span class="s2">"</span>, math/NR, english/NR, computer/NR
<span class="o">}</span>
</code></pre>
</div>

<ul>
  <li>可以将awk写成一个文件执行，调用时使用-f来指定：awk -f cal.awk score.txt</li>
</ul>

<h2 id="tocAnchor-1-1-3">其他</h2>

<p>还有条件控制等，实际上这几乎是一门编程语言。这里主要关注简单一些的状况</p>

<h1 id="tocAnchor-1-5">内建变量</h1>

<table>
  <tbody>
    <tr>
      <td>$0</td>
      <td>当前记录（这个变量中存放着整个行的内容）</td>
    </tr>
    <tr>
      <td>$1~$n</td>
      <td>当前记录的第n个字段，字段间由FS分隔</td>
    </tr>
    <tr>
      <td>FS</td>
      <td>输入字段分隔符 默认是空格或Tab</td>
    </tr>
    <tr>
      <td>NF</td>
      <td>当前记录中的字段个数，就是有多少列</td>
    </tr>
    <tr>
      <td>NR</td>
      <td>已经读出的记录数，就是行号，从1开始，如果有多个文件话，这个值也是不断累加中。</td>
    </tr>
    <tr>
      <td>FNR</td>
      <td>当前记录数，与NR不同的是，这个值会是各个文件自己的行号</td>
    </tr>
    <tr>
      <td>RS</td>
      <td>输入的记录分隔符， 默认为换行符</td>
    </tr>
    <tr>
      <td>OFS</td>
      <td>输出字段分隔符， 默认也是空格</td>
    </tr>
    <tr>
      <td>ORS</td>
      <td>输出的记录分隔符，默认为换行符</td>
    </tr>
    <tr>
      <td>FILENAME</td>
      <td>当前输入文件的名字</td>
    </tr>
  </tbody>
</table>

<h1 id="tocAnchor-1-6">匹配</h1>

<p>可以在匹配部分使用grep类似的语法。模式以~开头，写在两个斜杠中间</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>awk <span class="s1">'$6 ~ /FIN|TIME/ {print NR,$4,$5,$6}'</span> 
</code></pre>
</div>

<p>表示第六个分量，如果是FIN或TIME就算做匹配成功</p>

<h1 id="tocAnchor-1-7">举例</h1>

<p>主要来自leetcode</p>

<h2 id="tocAnchor-1-7-1">输出文件第十行</h2>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>gawk <span class="s1">'NR==10 {print $0}'</span> file.txt
gawk <span class="s1">'NR==10'</span> file.txt
</code></pre>
</div>

<h2 id="tocAnchor-1-7-2">
  <a href="https://leetcode.com/problems/transpose-file/">文件转置</a>
</h2>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>awk <span class="s1">' { 
    for (i = 1; i &lt;= NF; i++)  {
        a[NR, i] = $i
    }
}
NF &gt; p { p = NF }
END {    
    for (j = 1; j &lt;= p; j++) {
        str = a[1, j]
        for (i = 2; i &lt;= NR; i++){
            str = str " " a[i, j]
        }
        print str
    }
}'</span> file.txt
</code></pre>
</div>

<h2 id="tocAnchor-1-7-3">
  <a href="https://leetcode.com/problems/valid-phone-numbers/">有效电话号码</a>
</h2>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>awk  <span class="s1">'$0 ~ /^\([0-9]{3}\) [0-9]{3}-[0-9]{4}$/ || /^[0-9]{3}-[0-9]{3}-[0-9]{4}$/ {print  $0}'</span> file.txt
</code></pre>
</div>

<h2 id="tocAnchor-1-7-4">
  <a href="https://leetcode.com/problems/word-frequency/">单词频率统计</a>
</h2>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>awk <span class="s1">'
BEGIN{
    while(getline &lt; "words.txt") {
        for(i = 1; i &lt;= NF; i += 1)  map_wf[$i]++; 
    }
    n = asort(map_wf, arr_f); 
    for(word in map_wf) {
        map_fw[map_wf[word]] = word; 
    }
    for(j = n; j &gt;= 1; j -= 1) {
        f = arr_f[j];
        printf("%s %d\n", map_fw[f], f);
    }
}'</span>
</code></pre>
</div>

    </div>

    <hr>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
     
    	<li><a href="categories#CSE-ref">
    		CSE <span>8</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="tags#awk-ref">awk <span>1</span></a></li>
    
  



    </ul>
    


    <div class="pagination pagination-lg">
      
      <ul>
      
        <li class="prev"><a href="/posts/java%E6%80%BB%E7%BB%93" title="java总结">&larr; Previous（前一篇）</a></li>
      
        <li><a href="">Archive（目录）</a></li>
      
        <li class="next"><a href="/posts/%E4%BD%BF%E7%94%A8googleDrive%E5%A4%87%E4%BB%BD%E9%85%8D%E7%BD%AE" title="使用googleDrive备份配置">Next（后一篇） &rarr;</a></li>
      
      </ul>
    </div>


<script type="text/javascript">
    $(document).ready(
        function expand() {
            var node = $("h1")
            for (var i = 0; i < node.length; i++) {
                var t = node[i]
                  var num = $("[href='#" + t.id + "']").children("span.tocnumber")
                  t.innerText = num.text() + "    " + t.innerText
            }

            node = $("h2")
            for (var i = 0; i < node.length; i++) {
                  var t = node[i]
                  var num = $("[href='#" + t.id + "']").children("span.tocnumber")
                  t.innerText = num.text() + "   " + t.innerText
            }

            
        }
    );
</script>
    
  </div>
</div>

      </div>
      <hr/>
      <center> <footer>
        &copy; 2016 Yaccai with help from <a href="http://jekyllrb.com" target="_blank" title="The simple, blog-aware, static site generator.">Jekyll</a>. Hosted by <a href="https://pages.github.com/" target="_blank" title="GitHub Pages">GitHub</a>.
        <br><br>
      </footer> </center>


    </div>


  </body>
</html>

