

<!DOCTYPE html  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
  <head>
    <meta charset="utf-8">
    <title>ffmpeg</title>
    
    <meta name="author" content="Yaccai">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- <link href="/css/blog.css" rel="stylesheet" type="text/css" media="all"> -->
    <link href="/css/syntax.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/bootstrap.2.2.2.min.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/font-awesome.min.css" rel="stylesheet" type="text/css" media="all">
    
  <script type="text/javascript" src="/js/jquery.min.js"></script>
  <script type="text/javascript" src="/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/js/jquery.tocLight.js"></script>

    <!-- atom & rss feed -->
    <link href="" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">yaccai</a>
          <ul class="nav">
            <li><a href="/explore.html">Explore / 浏览</a></li>
            <li><a href="/archive.html">Archive / 存档</a></li>
            <li><a href="/about.html">About / 关于</a></li>

<!--             <li><a href="https://github.com/yaccai">Github</a></li> -->
          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        

<div class="page-header">
  <h11>ffmpeg </h11>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span> </span>
    </div>
    <div class="content">
      <div id="toc-container">
  <table class="toc" id="toc">
    <tbody>
      <tr>
        <td>
          <div id="toctitle">
            <h2>Contents</h2>
          </div>
          <ul>
            <li class="toc_level-1 toc_section-1">
              <a href="#tocAnchor-1-1"><span class="tocnumber">1</span> <span class="toctext">online</span></a>
            </li>
            <li class="toc_level-1 toc_section-2">
              <a href="#tocAnchor-1-2"><span class="tocnumber">2</span> <span class="toctext">文件转换</span></a>
            </li>
            <li class="toc_level-1 toc_section-3">
              <a href="#tocAnchor-1-3"><span class="tocnumber">3</span> <span class="toctext">文件合并</span></a>
              <ul>
                <li class="toc_level-2 toc_section-4">
                  <a href="#tocAnchor-1-3-1"><span class="tocnumber">3.1</span> <span class="toctext">普通合并</span></a>
                </li>
                <li class="toc_level-2 toc_section-5">
                  <a href="#tocAnchor-1-3-2"><span class="tocnumber">3.2</span> <span class="toctext">concat合并</span></a>
                </li>
              </ul>
            </li>
            <li class="toc_level-1 toc_section-6">
              <a href="#tocAnchor-1-6"><span class="tocnumber">4</span> <span class="toctext">文件截取</span></a>
            </li>
            <li class="toc_level-1 toc_section-7">
              <a href="#tocAnchor-1-7"><span class="tocnumber">5</span> <span class="toctext">提取</span></a>
              <ul>
                <li class="toc_level-2 toc_section-8">
                  <a href="#tocAnchor-1-7-1"><span class="tocnumber">5.1</span> <span class="toctext">提取音频</span></a>
                </li>
                <li class="toc_level-2 toc_section-9">
                  <a href="#tocAnchor-1-7-2"><span class="tocnumber">5.2</span> <span class="toctext">提取视频</span></a>
                </li>
              </ul>
            </li>
            <li class="toc_level-1 toc_section-10">
              <a href="#tocAnchor-1-10"><span class="tocnumber">6</span> <span class="toctext">水印</span></a>
            </li>
            <li class="toc_level-1 toc_section-11">
              <a href="#tocAnchor-1-11"><span class="tocnumber">7</span> <span class="toctext">翻转和旋转</span></a>
            </li>
            <li class="toc_level-1 toc_section-12">
              <a href="#tocAnchor-1-12"><span class="tocnumber">8</span> <span class="toctext">参数设置</span></a>
              <ul>
                <li class="toc_level-2 toc_section-13">
                  <a href="#tocAnchor-1-12-1"><span class="tocnumber">8.1</span> <span class="toctext">主要参数</span></a>
                </li>
                <li class="toc_level-2 toc_section-14">
                  <a href="#tocAnchor-1-12-2"><span class="tocnumber">8.2</span> <span class="toctext">视频参数</span></a>
                </li>
                <li class="toc_level-2 toc_section-15">
                  <a href="#tocAnchor-1-12-3"><span class="tocnumber">8.3</span> <span class="toctext">声音参数</span></a>
                </li>
              </ul>
            </li>
            <li class="toc_level-1 toc_section-16">
              <a href="#tocAnchor-1-16"><span class="tocnumber">9</span> <span class="toctext">举例</span></a>
            </li>
          </ul>
        </td>
      </tr>
    </tbody>
  </table>
</div><h1 id="tocAnchor-1-1">online</h1>
<ul>
  <li><a href="http://ffmpeg.org/ffmpeg.html">ffmpeg</a></li>
  <li><a href="https://gist.github.com/sxyx2008/9d5572a25063790db5fb">简单实用</a></li>
  <li><a href="http://www.cnblogs.com/vicowong/archive/2011/03/08/1977088.html">详细</a></li>
  <li><a href="http://www.labnol.org/internet/useful-ffmpeg-commands/28490/">另一个实例</a></li>
</ul>

<h1 id="tocAnchor-1-2">文件转换</h1>
<ul>
  <li>ffmpeg -i infile outfile<br />
在outfile之前一般应该加上文件格式， -f mp4 等，也可自动识别不写
如果不转吗只是改变封装格式 用-c copy</li>
  <li>ffmpeg -i infile -acodec aac -vcodec libx264 out.mp4</li>
  <li>ffmpeg -i infile -acodec aac -vcodec copy    out.mp4 
针对无法出声音的状况</li>
</ul>

<h1 id="tocAnchor-1-3">文件合并</h1>

<h2 id="tocAnchor-1-3-1">普通合并</h2>
<p>ffmpeg -i input1 -i input2 … -i inputn -c copy outfile</p>

<ul>
  <li>-c copy 表示复制</li>
  <li>可以使用 -f mp4类似，将进行必要的转码</li>
</ul>

<h2 id="tocAnchor-1-3-2">concat合并</h2>
<p>ffmpeg -f concat -i safe 0 videolistfile -c copy outvideofile</p>

<ul>
  <li>比如：ffmpeg -f concat -safe 0 -i “唐顿庄园 2015圣诞特辑篇.flv.txt”  -c copy “唐顿庄园 2015圣诞特辑篇.flv”</li>
  <li>加上safe中的0选项表示接受所有路径，通常含有特殊字符的路径会出现处理错误<br />
videolistfile通常是text文件，包含需要合并文件的路径</li>
  <li>视频容器是MPEG-1, MPEG-2 PS或DV等可以直接进行合并的</li>
</ul>

<h1 id="tocAnchor-1-6">文件截取</h1>
<p>ffmpeg -ss START -t DURATION -i INPUT -vcodec copy -acodec copy OUTPUT</p>

<ul>
  <li>ss 开始时间，如： 00:00:20，表示从20秒开始；</li>
  <li>t 时长，如： 00:00:10，表示截取10秒长的视频；</li>
  <li>vcodec copy 和 -acodec copy表示所要使用的视频和音频的编码格式，这里指定为copy表示原样拷贝；</li>
  <li>ffmpeg -ss 00:00:07 -t 00:03:38 -i “name1.mp4” -c copy “name2.mp4”</li>
</ul>

<h1 id="tocAnchor-1-7">提取</h1>

<h2 id="tocAnchor-1-7-1">提取音频</h2>
<p>ffmpeg -i m.mp4 -b:a 128k mo.mp3</p>

<p>ffmpeg -i DeadPoetsSocietyCD1.avi -ss 00:00:00.000 -to 00:02:00.000 -b:a output.mp3</p>

<h2 id="tocAnchor-1-7-2">提取视频</h2>

<p>ffmpeg -i mel.mp4 -f h264 m.mp4</p>

<h1 id="tocAnchor-1-10">水印</h1>

<p>ffmpeg -i 1.mp4 -i ll.png -filter_complex ‘overlay=10:main_h-overlay_h-10’ -y 11.mp4</p>

<p>ffmpeg -i 1.mp4 -i lm.png -filter_complex ‘overlay=main_w-overlay_w-10:10’ -y 11.mp4</p>

<ul>
  <li>左上角为 overlay=0:0</li>
  <li>右上角为 overlay= main_w-overlay_w:0</li>
  <li>右下角为 overlay= main_w-overlay_w:main_h-overlay_h</li>
  <li>左下角为 overlay=0: main_h-overlay_h</li>
</ul>

<h1 id="tocAnchor-1-11">翻转和旋转</h1>

<ul>
  <li>水平翻转：左右翻转 ffplay -i in.mp4 -vf hflip</li>
  <li>垂直翻转：上下翻转 ffplay -i in.mp4 -vf vflip</li>
  <li>旋转 fplay -i in.mp4 -vf transpose=?
    <ul>
      <li>0:逆时针旋转90°然后垂直翻转</li>
      <li>1:顺时针旋转90°</li>
      <li>2:逆时针旋转90°</li>
      <li>3:顺时针旋转90°然后水平翻转</li>
    </ul>
  </li>
</ul>

<h1 id="tocAnchor-1-12">参数设置</h1>

<h2 id="tocAnchor-1-12-1">主要参数</h2>
<ul>
  <li>-i  设置输入档名。</li>
  <li>-f  设置输出格式。</li>
  <li>-y  若输出文件已存在时则覆盖文件。</li>
  <li>-fs  超过指定的文件大小时则结束转换。</li>
  <li>-ss  从指定时间开始转换。</li>
  <li>-t从-ss时间开始转换（如-ss 00:00:01.00 -t 00:00:10.00即从00:00:01.00开始到00:00:11.00）。</li>
  <li>-title  设置标题。</li>
  <li>-timestamp  设置时间戳。</li>
  <li>-vsync  增减Frame使影音同步。</li>
</ul>

<h2 id="tocAnchor-1-12-2">视频参数</h2>
<ul>
  <li>-b:v  设置视频流量，默认为200Kbit/秒。（单位请引用下方注意事项）</li>
  <li>-r  设置帧率值，默认为25。</li>
  <li>-s  设置画面的宽与高 例如：568x320 1280x720 中间为w ‘x’ y z 。</li>
  <li>-aspect  设置画面的比例。</li>
  <li>-vn  不处理视频，于仅针对声音做处理时使用。</li>
  <li>-vcodec( -c:v )  设置视频视频编解码器，未设置时则使用与输入文件相同之编解码器。</li>
</ul>

<h2 id="tocAnchor-1-12-3">声音参数</h2>
<ul>
  <li>-b:a——设置每Channel（最近的SVN版为所有Channel的总合）的流量。（单位请引用下方注意事项）</li>
  <li>-ar——设置采样率。</li>
  <li>-ac——设置声音的Channel数。</li>
  <li>-acodec ( -c:a ) ——设置声音编解码器，未设置时与视频相同，使用与输入文件相同之编解码器。</li>
  <li>-an——不处理声音，于仅针对视频做处理时使用。</li>
  <li>-vol——设置音量大小，256为标准音量。（要设置成两倍音量时则输入512，依此类推。）</li>
</ul>

<h1 id="tocAnchor-1-16">举例</h1>
<p>ffmpeg -f avfoundation -list_devices true -i “”  
列出设备</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    [AVFoundation input device @ 0x7fb9cad01340] AVFoundation video devices:
    [AVFoundation input device @ 0x7fb9cad01340] [0] FaceTime HD Camera
    [AVFoundation input device @ 0x7fb9cad01340] [1] Capture screen 0
    [AVFoundation input device @ 0x7fb9cad01340] AVFoundation audio devices:
    [AVFoundation input device @ 0x7fb9cad01340] [0] Built-in Microphone
</code></pre>
</div>

<p>ffmpeg  -f avfoundation -framerate 30 -i “0:0” -y .out.mp4
ffplay  -f avfoundation -framerate 30 -i “0”
使用0设备录制视频 并存储到out.mpg文件</p>

    </div>

    <hr>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
     
    	<li><a href="categories#使用配置-ref">
    		使用配置 <span>6</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="tags#ffmpeg-ref">ffmpeg <span>1</span></a></li>
    
  



    </ul>
    


    <div class="pagination pagination-lg">
      
      <ul>
      
        <li class="prev"><a href="/posts/%E6%A0%91%E8%8E%93%E6%B4%BE" title="树莓派">&larr; Previous（前一篇）</a></li>
      
        <li><a href="">Archive（目录）</a></li>
      
        <li class="next"><a href="/posts/%E4%B8%8B%E8%BD%BD%E5%B7%A5%E5%85%B7" title="下载工具">Next（后一篇） &rarr;</a></li>
      
      </ul>
    </div>


<script type="text/javascript">
    $(document).ready(
        function expand() {
            var node = $("h1")
            for (var i = 0; i < node.length; i++) {
                var t = node[i]
                  var num = $("[href='#" + t.id + "']").children("span.tocnumber")
                  t.innerText = num.text() + "    " + t.innerText
            }

            node = $("h2")
            for (var i = 0; i < node.length; i++) {
                  var t = node[i]
                  var num = $("[href='#" + t.id + "']").children("span.tocnumber")
                  t.innerText = num.text() + "   " + t.innerText
            }

            
        }
    );
</script>
    
  </div>
</div>

      </div>
      <hr/>
      <center> <footer>
        &copy; 2016 Yaccai with help from <a href="http://jekyllrb.com" target="_blank" title="The simple, blog-aware, static site generator.">Jekyll</a>. Hosted by <a href="https://pages.github.com/" target="_blank" title="GitHub Pages">GitHub</a>.
        <br><br>
      </footer> </center>


    </div>


  </body>
</html>

