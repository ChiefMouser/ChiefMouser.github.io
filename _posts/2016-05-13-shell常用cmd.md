---
layout: post
title: shell常用cmd
date: 2016-05-13
category: CSE
tags: [shell]
---


不是系统介绍，只列举几个常用的

<!-- more -->

# 比较  

## 整数比较

-eq | -ne | -gt | -lt | -ge | -le

## 字符串比较

== | != | < | < | !或-z(空串检测)| -n

## 文件测试

-e 存在| -f 文件| -d 目录| -r 可读| -w 可写| -x 可执行

单目检测 变量在右侧

## [] 差别 [[ ]]

- 数字： -eq -ne -lt -le -gt -ge，[[ ]]同 [ ]一致
- 文件： -r、-l、-w、-x、-f、-d、-s、-nt、-ot，[[ ]]同 [ ]一致
- 字符串： > < =(同==) != -n -z，不可使用“<=”和“>=”，[[ ]]同 [ ]一致，但在[]中，>和<- 必须使用\进行转义，即\>和\<
- 逻辑： []为 -a -o ! [[ ]] 为&& \|\| !
- 数学运算： [] 不可以使用 [[ ]]可以使用+ - * / %
- 组合： 均可用各自逻辑符号连接的数字（运算）测试、文件测试、字符测试

[[ ]]更好用一些，主要区分不同测试类型时 比较符号

# 单双引号

双引号中的$变量会发生替换，而单引号不会

# 分割文件名字
file="qwe.mp4"
echo "${file%.*}"        #文件名前部分
echo "${file#*.}"      #文件名扩展部分

<br>
<br>
以上为部分语法
<br>
<br>

# 两块网卡
两块网卡冲突 
en0为无线，192.168.2.0 可接互联网，en4为有线网链接一个小的局域网，192.168.1.0。   
开机一小会儿可以同时正常工作，过一段时间，无法上网 netstat -nr 发现，en4所在网关变成了默认网关。
为什么会变不清楚，动态选择中有线网跳数少逐渐占优？ 解决办法：  

- sudo route delete default #奇怪路由表中有两个default，似乎只有一个有效  
- sudo route add default 192.168.2.1
- sudo route add 192.168.1.0/8 192.168.1.1  

修改mac地址
sudo ifconfig en3 ether C8:3A:35:06:CC:00


# 设置文件夹UI下隐藏 
- chflags hidden path
- chflags nohidden path

# crontab
-e 进入编辑， -l 查看  
一条记录格式 :  

    ? ? ? ? ?  command_to_execute  
    │ │ │ │ │  
    │ │ │ │ └─── day of week (0 - 6) (0 to 6 are Sunday to Saturday)  
    │ │ │ └──────── month (1 - 12)  
    │ │ └───────────── day of month (1 - 31)  
    │ └────────────────── hour (0 - 23)  
    └─────────────────────── min (0 - 59)  
    如果每个单位（分钟，小时，天。。。）都要执行， 在对应位写 *  
    如果想每个若干时间单位执行，对应的写 */3  
    几个栗子：
    43 21 * * * 每月周日的21:43 执行  
    0,10 17 * * 0,2,3 每周日，周二，周三，的17:00和17:10执行  
    0-10 17 1 * 0,2,3 其他不变，17点整到10分每分钟都执行一次  
    * * */2 * * 每隔1天，另一天中每分钟执行   
    2 8-20/3 * * *　8:02,11:02,14:02,17:02,20:02 执行  
        
注意，crontab命令执行时没有完整的PATH变量，需要在执行的sh中添加PATH： 

    \#!/bin/sh  
    PATH=/usr/local/bin:/usr/bin:/bin:/usr/sbin....  
    \#PATH="/usr/local/bin/:$PATH"  
    经查，只有/usr/bin:/bin两个目录  
    ... 1>/dev/null 2>/dev/null \#重定向到空设备文件  

邮件， 每执行一个任务就会发邮件，要消除在文件顶部加 MAILTO=""

## dd 备份 
dd if=/dev/disk0s1 of=./efi.dmg
dd if=/dev/disk0 of=MBR.img bs=512 count=1

# 挂分区  
efi     sudo mount -t msdos /dev/disk0s1 /Volumes/efi 
windows sudo mount -t NTFS  /dev/disk0s4 /Volumes/Windows 

# 其他

- [快捷键](https://support.apple.com/zh-cn/HT201236)
- [quicklook](https://github.com/sindresorhus/quick-look-plugins)
- [程序推荐](https://github.com/sindresorhus/awesome)

主文件加下面的文件名变成了英文   
touch ~/downloads/.localized

# diskutil
- DiskIdentifier <--> DI 看上去类似disk1s3 
- DeviceNode     <--> DN 看上去是/dev/disk1s3
- MountPoint     <--> MP 类似于 /Volumes/My_Partition

- format         <--> FS  可用diskutil listFilesystems查看
- T              <--> part1Format part1Name part1Size 即格式 名称 大小
- 分区大小指定方法: 
    - 浮点数后跟B,K(10^3)),M(10^6)),G(10^9),T(10^12),P(10^15),E(10^18)等(单位是字节Byte)，用来表述xxMB/GB/TB的空间大小
    - 浮点数后跟S(512字节区块),Ki(2^10)),Mi(2^20)),Gi(2^30),Ti(2^40),Pi(2^50),Ei(2^60)等(单位是字节Byte)，用来表述xxMB/GB/TB的空间大小
    - 浮点数后跟%，用来表述占用磁盘空间的百分比
    - R，是说所有剩余空间。最好放在最后一个 


## mergePartitions
合并两个分区  
diskutil mergePartitions [force] FS name DI1\|DN1 dI2\|DN2  

- 例如 diskutil mergePartitions JHFS+ NewName disk3s4 disk3s7
- 第一个分区应该是磁盘中靠前的分区vol，第二个分区必须紧跟第一个分区
- 如果第一个分区不是JHFS+，就需要指定force
- 没有force项，则第二个分区给格式化，数据丢失。如果有force，两分区都格式化丢失数据

## partitionDisk
diskutil partitionDisk MP|DI|DN [numberOfPartitions] [APM|MBR|GPT] [T1 T2 T3...]

- MP\|DI\|DN 被分区的磁盘
- numberOfPartitions 分区个数
- APM\|MBR\|GPT 磁盘分区方案
- 后面是对应每个分区的三元组
- 最后一个分区可以不用指定大小，会自动到达到磁盘结尾
- diskutil partitionDisk disk1 GPT exFAT VN1 25% free VN2 300Mi JHFS+ VN3 R
- diskutil partitionDisk disk1 MBR fat32 EFI 314.6M JHFS+ InstallOS R


## splitPartition
所有数据都会丢失  
拆分一个分区为若干个  
diskutil splitPartition MP\|DI\|DN [numberOfPartitions] [T1 T2 T3...]

## resizeVolume
非破坏性的缩放分区大小，只支持JHFS+ 

- *缩小* diskutil resizeVolume MP\|DI\|DN size [T1 T2 T3...]
    - size是调整后的大小
    - 缩小分区，可以顺便对多出来的空间指定新分区，按照之前三元组的方式指定
    - diskutil resizeVolume disk0s2 50G "MS-DOS FAT32" Public 20G
    - diskutil resizeVolume disk1s3 0B
- *放大* diskutil resizeVolume MP\|DI\|DN size



# hdiutil 映像操作
可以选用的 DMG 格式有 

- UDRO - 只读
- UDZO - 压缩
- UDSP - 稀疏
- UDRW - 读/写
- UDTO - DVD/CD 主映像

hdiutil create <sizespec> <imagepath>
其他有用的可加上的参数

- -fs制定文件系统 
- -srcfolder <source folder> 从文件创建

hdiutil create -size 100M -stdinpass -format UDZO -srcfolder code code.dmg
hdiutil create -size 1G -fs JHFS+ -volname 'qvbdata'  qvbdata.dmg

## 修改大小
hdiutil resize 150M /path/to/the/diskimage

## 挂载 卸载
hdiutil attach archive_name.dmg
hdiutil eject /Volumes/archive_name/

## 转换
hdiutil convert iso文件路径 -format UDRW -o 输出的dmg文件路径
hdiutil convert dmg文件路径 -format UDTO -o 输出的iso文件路径

# 端口占用

lsof -i
netstat -an | grep 3306
